server { 
  listen 80; 
    server_name test.ru; 
    server_name_in_redirect off; 

    access_log /var/log/nginx/localhost.access_log; 
    error_log /var/log/nginx/localhost.error_log info; 

    root "{{ root_joomla }}"; 
    index index.php index.html index.htm default.html default.htm; 

    # Поддержка API 
    location /api/ { 
	try_files $uri $uri/ /api/index.php?$args; 
    } 

    # Поддержка чистых (т. е. дружественных к поисковым системам) URL 
    location / { 
        try_files $uri $uri/ /index.php?$args; 
    } 

    # добавить глобальный заголовок x-content-type-options 
    add_header X-Content-Type-Options nosniff; 

    # запретить запуск скриптов внутри доступных для записи каталогов 
    location ~* /(images|cache|media|logs|tmp)/.*\.(php|pl|py|jsp|asp|sh|cgi)$ { 
        return 403; 
        error_page 403 /403_error.html; 
    } 

    location ~ \.php$ { 
      fastcgi_pass 127.0.0.1:9000; 
      fastcgi_index index.php; 
      include fastcgi_params; 
      fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; 
      include /etc/nginx/fastcgi.conf; 
    } 

    # кэширование файлов 
    location ~* \.(ico|pdf|flv)$ { 
        expires 1y; 
    } 

    location ~* \.(js|css|png|jpg|jpeg|gif|swf|xml|txt)$ { 
        expires 14d; 
    } 

}
